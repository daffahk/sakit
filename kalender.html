<?
var urlx=getScriptUrl();
?>
<!DOCTYPE html>
<html lang="en">
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Dashboard - NiceAdmin Bootstrap Template</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.bubble.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/2.5.0/remixicon.css" rel="stylesheet">
    <link href="https://bootstrapmade.com/demo/templates/NiceAdmin/assets/vendor/simple-datatables/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css">
    <style>
      .fc-state-default {
        text-shadow: none;
        box-shadow: none;
      }

      .fc-basic-view .fc-body .fc-row {
        min-height: 5rem;
      }

      .fc-toolbar .fc-button-group {
        border: 1px solid #2961ff;
        border-radius: 4px;
      }

      .fc-toolbar .fc-button {
        background: #2961ff;
        color: #fff;
        border: none;
      }

      .fc-toolbar .fc-button:hover {
        background: #2961ff;
        opacity: 1;
      }

      .fc-toolbar .fc-button.fc-state-active {
        background: #fff;
        color: #2961ff;
      }

      .fc-widget-header {
        border: 0px !important;
      }

      .fc-widget-content {
        border-color: rgba(120, 130, 140, 0.13) !important;
      }

      .fc-widget-content tr {
        border-bottom: none;
      }

      .fc-view {
        margin-top: 0px;
      }

      .fc-toolbar {
        margin: 0px;
        padding: 24px 0px;
      }

      .fc-event {
        border-radius: 0px;
        border: none;
        cursor: move;
        color: #fff !important;
        font-size: 13px;
        margin: 1px -1px 0 -1px;
        padding: 5px 5px;
        text-align: center;
        background: #40c4ff;
      }
    </style>
    <!-- Template Main CSS File -->
    <link href="https://bootstrapmade.com/demo/templates/NiceAdmin/assets/css/style.css" rel="stylesheet">
    <!-- =======================================================
  * Template Name: NiceAdmin - v2.5.0
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    <style>
      .loading-screen {
        position: fixed;
        z-index: 999;
        height: 100%;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .loading-spinner {
        border: 16px solid #f3f3f3;
        border-top: 16px solid #3498db;
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="loading-screen" class="loading-screen" style="display: flex;">
      <div class="loading-spinner"></div>
    </div>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">
      <div class="d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center">
          <img src="assets/img/logo.png" alt="">
          <span class="d-none d-lg-block">SAKIT</span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
      </div>
      <!-- End Logo -->
      <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
          <li class="nav-item d-block d-lg-none">
            <a class="nav-link nav-icon search-bar-toggle " href="#">
              <i class="bi bi-search"></i>
            </a>
          </li>
          <!-- End Search Icon-->
        </ul>
      </nav>
      <!-- End Icons Navigation -->
    </header>
    <!-- End Header -->
    <?!= include('sidebar'); ?>
    <main id="main" class="main">
      <div class="pagetitle">
        <h1>Dashboard</h1>
        <nav>
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="index.html">Home</a>
            </li>
            <li class="breadcrumb-item active">Dashboard</li>
          </ol>
        </nav>
      </div>
      <!-- End Page Title -->
      <section class="section dashboard">
        <div class="row">
          <!-- Left side columns -->
          <div class="col-lg-12">
            <div class="row">
              <!-- Recent Sales -->
              <div class="col-12">
                <div class="card recent-sales overflow-auto">
                  <div class="filter">
                    <a class="icon" href="#" data-bs-toggle="dropdown">
                      <i class="bi bi-three-dots"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                      <li class="dropdown-header text-start">
                        <h6>Filter</h6>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#hari_ini">Hari Ini</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#bulan_ini">Bulan Ini</a>
                      </li>
                    </ul>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">Kalender Pencairan <span>| Keseluruhan</span>
                    </h5>
                    <div class="container">
                      <div id="calendar"></div>
                      <div class="modal fade" id="KalenderModal" tabindex="-1" aria-hidden="true" style="display: none;">
                        <div class="modal-dialog modal-xl">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="tanggal_spm"></h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <table id="spm_tgl" class="table table-striped datatable">
                                <thead>
                                  <tr>
                                    <th scope="col" style="width: 5%;">No. SPM</th>
                                    <th scope="col" style="width: 10%;">Tgl. SPM</th>
                                    <th scope="col" style="width: 55%;">Uraian</th>
                                    <th scope="col" style="width: 10%;">Jumlah</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <!-- isi tabel akan di-generate oleh kode JavaScript -->
                                </tbody>
                              </table>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End Recent Sales -->
            </div>
          </div>
          <!-- End Left side columns -->
        </div>
      </section>
    </main>
    <!-- End #main -->
    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright"> &copy; Copyright <strong>
          <span>NiceAdmin</span>
        </strong>. All Rights Reserved </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ --> Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </footer>
    <!-- End Footer -->
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center">
      <i class="bi bi-arrow-up-short"></i>
    </a>
    <!-- Vendor JS Files -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.37.1/apexcharts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.1/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.3.2/tinymce.min.js"></script>
    <script src="https://bootstrapmade.com/demo/templates/NiceAdmin/assets/vendor/php-email-form/validate.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <!-- Template Main JS File -->
    <script src="https://bootstrapmade.com/demo/templates/NiceAdmin/assets/js/main.js"></script>
    <script>
      document.getElementById("loading-screen").style.display = "flex";

      function GetURL(callback) {
        google.script.run.withSuccessHandler(callback).getScriptUrl();
      }
      GetURL(function(url) {
        console.log("url : " + url);
        document.getElementById("link-daftar-spm").href = url + "?p=daftarspm";
        document.getElementById("home").href = url + "?p=home";
        document.getElementById("link-proyeksi-sp2d").href = url + "?p=proyeksi_sp2d";
        document.getElementById("link-proyeksi-spm").href = url + "?p=proyeksi_spm";
        document.getElementById("link-rka").href = url + "?p=rka";
        document.getElementById("link-kalender").href = url + "?p=kalender";
      });
      $(document).ready(function() {
        // panggil google.script.run() dengan handler kesuksesan
        google.script.run.withSuccessHandler(onSuccess).getKalender();

        function onSuccess(Array_Kalender) {
          $(document).ready(function() {
            // Data kalender dari sebuah array
            var kalender = [];
            //console.log("data dari server KAlender:", Array_Kalender);
            for (var i = 0; i < Array_Kalender.length; i++) {
              var tanggal = new Date(Array_Kalender[i][0]);
              var text = Array_Kalender[i][1];
              var angka = parseInt(text.replace(/\D/g, ''));
              angka = angka.toLocaleString('id-ID');
              kalender.push({
                title: angka,
                start: tanggal
              });
            }
            //console.log(kalender);
            // Menginisialisasi kalender dengan data dari array
            $('#calendar').fullCalendar({
              editable: true, // Mengaktifkan pengeditan pada kalender
              displayEventTime: false,
              header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,basicWeek,basicDay'
              },
              events: kalender, // Menggunakan data dari array sebagai acara pada kalender
              // Memanggil fungsi eventClick ketika pengguna mengklik sebuah acara
              eventClick: function(info) {
                document.getElementById("loading-screen").style.display = "flex";
                
                $('#KalenderModal').modal('show');
                $('#tanggal_spm').val(moment(info.event.start).format('dd/mm/yyyy'));
                google.script.run.withSuccessHandler(onSuccess).getSPMTgl();

                function onSuccess(Array_SPM) {
                  document.getElementById("loading-screen").style.display = "none";
                  try {
                    if (Array_SPM === null) {
                      throw new Error("Data dari server adalah null.");
                    }
                    console.log("data dari server SPM:", Array_SPM);
                    // hapus baris pada tabel kecuali header
                    var table_spm = $('#spm_tgl').DataTable({
                      order: [
                        [1, 'desc']
                      ],
                       destroy: true,
                    
                    });
                    table_spm.clear().draw();
                    // tambahkan data pada tabel
                    for (var i = 0; i < Array_SPM.length; i++) {
                      var dataRowSPM = [" <a href =<?= urlx ?>?p=detilspm&no="+ Array_SPM[i][0]+">"+Array_SPM[i][0]+"</a>",
                        Array_SPM[i][1],
                        Array_SPM[i][2],
                        Array_SPM[i][3]
                      ];
                      table_spm.row.add(dataRowSPM).draw();
                    }
                    
                  } catch (error) {
                    console.error("Terjadi kesalahan saat memproses data dari server:", error);
                  }
                }
                
              }
            });
          });
          document.getElementById("loading-screen").style.display = "none";
        }
      });
    </script>
  </body>
</html>
